@page
@model ProiectPAW1.Pages.Articles.CreateModel
@{
    ViewData["Title"] = "Create Article";
}

<div class="container">
    <div class="row mb-4">
        <div class="col">
            <h1 class="display-4">
                <i class="bi bi-plus-circle"></i> Create Article
            </h1>
            <p class="lead text-muted">Share your knowledge with the world</p>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Model.StatusMessage))
    {
        <div class="alert alert-info alert-dismissible fade show" role="alert">
            @Model.StatusMessage
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <form method="post" enctype="multipart/form-data">
        <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

        <div class="row">
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title">Article Information</h5>
                        <div class="mb-3">
                            <label asp-for="Article.Title" class="form-label">Title</label>
                            <input asp-for="Article.Title" class="form-control" placeholder="Enter article title" />
                            <span asp-validation-for="Article.Title" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Article.Domain" class="form-label">Domain</label>
                            <select asp-for="Article.Domain" class="form-select">
                                <option value="">Select Domain</option>
                                <option value="Art">Art</option>
                                <option value="History">History</option>
                                <option value="Science">Science</option>
                                <option value="Geography">Geography</option>
                                <option value="Sport">Sport</option>
                                <option value="Politics">Politics</option>
                                <option value="Religion">Religion</option>
                            </select>
                            <span asp-validation-for="Article.Domain" class="text-danger"></span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title mb-0">Chapters</h5>
                            <button type="button" id="addChapter" class="btn btn-primary btn-sm">
                                <i class="bi bi-plus-circle"></i> Add Chapter
                            </button>
                        </div>

                        <div id="chaptersContainer">
                            @for (var i = 0; i < Model.Article.Chapters.Count; i++)
                            {
                                <div class="chapter-item mb-4">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <h6 class="mb-0">Chapter @(i + 1)</h6>
                                        <button type="button" class="btn btn-danger btn-sm remove-chapter">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Title</label>
                                        <input asp-for="Article.Chapters[i].Title" class="form-control" placeholder="Enter chapter title" />
                                        <span asp-validation-for="Article.Chapters[i].Title" class="text-danger"></span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Content</label>
                                        <textarea asp-for="Article.Chapters[i].Content" class="form-control" rows="5" 
                                                placeholder="Write your chapter content here..."></textarea>
                                        <span asp-validation-for="Article.Chapters[i].Content" class="text-danger"></span>
                                    </div>
                                    <input type="hidden" asp-for="Article.Chapters[i].OrderIndex" value="@i" />
                                </div>
                            }
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Article Settings</h5>
                        
                        <div class="mb-4">
                            <label class="form-label">Featured Image</label>
                            <input type="file" name="FeaturedImage" class="form-control" accept="image/*" />
                            <div class="form-text">Recommended size: 1200x630 pixels</div>
                        </div>

                        <div class="mb-4">
                            <div class="form-check">
                                <input asp-for="Article.IsProtected" class="form-check-input" />
                                <label asp-for="Article.IsProtected" class="form-check-label">Protect Article</label>
                            </div>
                            <div class="form-text">Only registered users can edit protected articles.</div>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">
                            <i class="bi bi-save"></i> Create Article
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function () {
            let chapterIndex = @Model.Article.Chapters.Count;

            function updateChapterNumbers() {
                $('.chapter-item h6').each(function(index) {
                    $(this).text('Chapter ' + (index + 1));
                });
            }

            $('#addChapter').click(function () {
                const template = `
                    <div class="chapter-item mb-4">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">Chapter ${chapterIndex + 1}</h6>
                            <button type="button" class="btn btn-danger btn-sm remove-chapter">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Title</label>
                            <input name="Article.Chapters[${chapterIndex}].Title" class="form-control" placeholder="Enter chapter title" />
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Content</label>
                            <textarea name="Article.Chapters[${chapterIndex}].Content" class="form-control" rows="5" 
                                    placeholder="Write your chapter content here..."></textarea>
                        </div>
                        <input type="hidden" name="Article.Chapters[${chapterIndex}].OrderIndex" value="${chapterIndex}" />
                    </div>
                `;
                $('#chaptersContainer').append(template);
                chapterIndex++;
            });

            $(document).on('click', '.remove-chapter', function () {
                $(this).closest('.chapter-item').remove();
                updateChapterNumbers();
            });
        });
    </script>
} 