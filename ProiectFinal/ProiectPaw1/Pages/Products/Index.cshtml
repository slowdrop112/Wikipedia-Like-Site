@page
@model ProiectPAW1.Pages.Articles.IndexModel
@{
    ViewData["Title"] = "Articles";
}

<div class="row mb-4">
    <div class="col">
        <h1 class="display-4">Articles</h1>
        <p class="lead text-muted">Explore our collection of articles</p>
        <a asp-page="Create" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Create Article
        </a>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-8">
        <form method="get" class="row g-3">
            <div class="col-md-4">
                <select asp-for="CurrentDomain" asp-items="Model.DomainList" class="form-select">
                    <option value="">All Domains</option>
                </select>
            </div>
            <div class="col-md-4">
                <select asp-for="SortOrder" class="form-select">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="title">Title A-Z</option>
                    <option value="title_desc">Title Z-A</option>
                    <option value="rating">Highest Rated</option>
                    <option value="rating_asc">Lowest Rated</option>
                </select>
            </div>
            <div class="col-md-4">
                <button type="submit" class="btn btn-secondary w-100">Apply Filters</button>
            </div>
        </form>
    </div>
</div>

<div class="row">
    @foreach (var article in Model.Articles)
    {
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                @if (article.Images.Any())
                {
                    <img src="@article.Images.First().ImagePath" 
                         class="card-img-top article-image" 
                         alt="@article.Images.First().AltText">
                }
                <div class="card-body">
                    <h5 class="card-title">
                        <a asp-page="./Details" asp-route-id="@article.Id" class="text-decoration-none">@article.Title</a>
                        @if (article.IsProtected)
                        {
                            <i class="bi bi-lock-fill text-warning" title="Protected Article"></i>
                        }
                    </h5>
                    <h6 class="card-subtitle mb-2 text-muted">
                        <span class="badge bg-secondary">@article.Domain</span>
                        by @article.Author?.UserName
                        @if (article.RatingCount > 0)
                        {
                            <span class="ms-2">
                                <i class="bi bi-star-fill text-warning"></i>
                                @article.AverageRating.ToString("F1")
                                <small>(@article.RatingCount @(article.RatingCount == 1 ? "rating" : "ratings"))</small>
                            </span>
                        }
                    </h6>
                    @if (article.Chapters.Any())
                    {
                        var firstChapter = article.Chapters.OrderBy(c => c.OrderIndex).First();
                        <p class="card-text">
                            @(firstChapter.Content.Length > 150 
                                ? firstChapter.Content.Substring(0, 150) + "..." 
                                : firstChapter.Content)
                        </p>
                    }
                    else
                    {
                        <p class="card-text text-muted">No content available</p>
                    }
                </div>
                <div class="card-footer text-muted">
                    <div class="d-flex justify-content-between align-items-center">
                        <small>
                            Created @article.CreatedAt.ToString("MMM dd, yyyy")
                        </small>
                        <div>
                            @if (User.Identity?.IsAuthenticated ?? false)
                            {
                                <a asp-page="./Edit" asp-route-id="@article.Id" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-pencil"></i>
                                </a>
                            }
                            <a asp-page="./Details" asp-route-id="@article.Id" class="btn btn-sm btn-outline-secondary">
                                <i class="bi bi-eye"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>

@if (!Model.Articles.Any())
{
    <div class="alert alert-info">
        No articles found. Be the first to <a asp-page="Create">create one</a>!
    </div>
} 